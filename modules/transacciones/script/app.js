var App={ViewModels:{},Models:{},DataSource:{},Views:{}},TRANSACTION_DATASOURCE_URL="https://www.billpocket.com/webappfake/index.php/test/get_test",VENTA="venta",VISA_IMG='<img src="assets/images/visa.png"/>  ',MASTERCARD_IMG='<img src="assets/images/mastercard.png"/>  ',TIME_ICON_HTML='<span class="glyphicon glyphicon-time"></span>',OK_ICON_HTML='<span class="glyphicon glyphicon-ok"></span>',NO_HAY_RESULTADOS="No hay resultados que coincidan el filtro.";var TransactionCollectionModel=function(b){var a=this;a.collection=[];a.type=b.type||VENTA;a.read=function(c){if(a.collection.length<1){TransactionCollectionDataSource.getTransactionCollectionRequest({tipotransaccion:a.type},function(e){var d=e.transacciones,g=d.length,f=0;for(f;f<g;f++){a.collection.push(d[f])}c(a)})}}};App.Models.TransactionCollectionModel=TransactionCollectionModel;var TransactionCollectionDataSource=(function(){return{getTransactionCollectionRequest:function(b,c){var a=b.tipotransaccion||VENTA;$.ajax({type:"GET",url:TRANSACTION_DATASOURCE_URL,data:{tipotransaccion:a},dataType:"json",success:c})}}}());App.DataSource.TransactionCollectionDataSource=TransactionCollectionDataSource;var TransactionCollectionViewModel=function(b){var a=this;a.datatable=b.datatable||{};a.init=function(d){var c=App.Models.TransactionCollectionModel;a.devolucionModel=new c({type:"devolucion"});a.ventasModel=new c({type:VENTA});a.showTransactionCollection(a.devolucionModel,d.callback);a.activeTypo=ko.observable(0)};a.showTransactionCollection=function(c,e){var d=c.collection;if(d.length===0){c.read(function(f){a.syncView(f.collection,e)})}else{a.syncView(c.collection,e)}};a.syncView=function(g,h){var c=a.datatable,f=g.length,e=0;c.clear();for(e;e<f;e++){var d=new TransactionViewModel(g[e]);c.row.add(d).draw()}if(h){h()}};a.showVentasAction=function(){a.activeTypo(1);a.toogleFiltersHelper(a.ventasModel)};a.showDevolucionesAction=function(){a.activeTypo(0);a.toogleFiltersHelper(a.devolucionModel)};a.toogleFiltersHelper=function(c){var d=$("#example");d.fadeTo(1000,0.5,function(){});a.showTransactionCollection(c,function(){d.stop().fadeTo(1000,1,function(){})})};a.clearFilterAction=function(){$("#example").dataTable().fnFilter("");$("#example_filter input").val("")};a.logoutAction=function(){window.location.href="../../modules/login"};a.init(b)};App.ViewModels.TransactionCollectionViewModel=TransactionCollectionViewModel;var TransactionViewModel=function(e,c){var a=this,f=["idtransaccion","fechahora","t2m","tipotarjeta","monto","tipotransaccion","etiqueta","dispersion"],d;for(var b=0;b<f.length;b++){d=f[b];a[d]=ko.observable(e[d])}a.formatedMonto=ko.computed({read:function(){return"$"+a.monto()}},a);a.formatedTarjeta=ko.computed({read:function(){var g="",h=a.t2m().split("=")[0];if(a.tipotarjeta()==="Visa"){g=VISA_IMG}else{g=MASTERCARD_IMG}g+=h;return g}},a);a.formatedDispersion=ko.computed({read:function(){var h=a.dispersion(),g=TIME_ICON_HTML;if(h==1){g=OK_ICON_HTML}return g}},a)};$(document).ready(function(){App.initializeUI=function(){App.Views.Datatable=$("#example").DataTable({columns:[{data:"idtransaccion()"},{data:"fechahora()"},{data:"formatedTarjeta()"},{data:"formatedMonto()"},{data:"tipotransaccion()"},{data:"etiqueta()"},{data:"formatedDispersion()"}],bSort:false,bPaginate:false,bInfo:false,"oLanguage":{"sSearch":"","sZeroRecords":NO_HAY_RESULTADOS},oClasses:{sFilterInput:"input-sm form-control",sFilterPlaceholder:"Filtrar",sFilter:"container dataTables_filter"}});var b='<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">'+'<div class="btn-group btn-group-sm">'+'<button type="button" class="btn btn-sm" data-bind="click: showVentasAction, css: { \'btn-default\': activeTypo() < 1, \'btn-primary\': activeTypo() > 0 }"><span class="hidden-xs">Ventas</span><span class="visible-xs glyphicon glyphicon-euro"></span></button>'+'<button type="button" class="btn btn-sm" data-bind="click: showDevolucionesAction, css: { \'btn-primary\': activeTypo() < 1, \'btn-default\': activeTypo() > 0 }"><span class="hidden-xs">Devoluciones</span><span class="visible-xs glyphicon glyphicon-transfer"></span></button>'+"</div>"+"</div>";$("#example_filter").append(b)};App.opening=function(){$(".loader").fadeOut(1000,function(){$(".content-body").removeClass("hidden");$(".content-body").fadeIn(1000,function(){})})};App.initializeUI();var a=new App.ViewModels.TransactionCollectionViewModel({datatable:App.Views.Datatable,callback:App.opening});ko.applyBindings(a)});